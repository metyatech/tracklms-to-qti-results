# Project-specific rules: tracklms-to-qti-results

## 概要

- Track LMS のデータを **QTI 3.0 Results Reporting**（結果報告）へ変換するツールを作る。
- 実装言語は Python、データモデルは Pydantic を前提とする。

## 適用範囲（言語）

- このリポジトリの主要実装は **Python** で行う。
- `agent-rules` の共通ルールに含まれる TypeScript/Node.js 前提の指示（例: TypeScript を標準とする等）は、このリポジトリのアプリ本体には適用しない。
  - ただし、ルール合成などツール都合で Node.js を使うことはある。

## ゴール

- 変換結果が仕様と入力に対して決定的であること（同じ入力→同じ出力）。
- 仕様の読み替え（マッピング）をコードで追跡できること（どの入力がどの要素へ行くか）。
- エラー時に原因が追えること（入力のどこが問題かを明示する）。

## Python / Pydantic 方針

- 可能な限り **型付け**（`typing`）を付け、Pydantic のモデルで境界（I/O）を明確化する。
- 変換のコアロジックは純粋関数に寄せ、I/O（ファイル読み書き、ネットワーク）と分離する。
- 例外は握りつぶさず、ユーザー向けエラー（何が・どこで・どう直すべきか）を出す。

## 変換設計の指針

- 仕様に登場する識別子（attemptId, itemId, candidateId 等）は、モデル上で名前を揃える。
- "とりあえず動く" 変換を優先しすぎず、マッピング表（設計ドキュメント）に基づき段階的に実装する。
- 入力の欠損・不整合は、
  - 回復可能: デフォルト値やスキップ方針を明示しつつ続行
  - 回復不能: 明示的に失敗
  のどちらかに揃える（サイレントフォールバック禁止）。

## テスト

- 変換結果の XML/JSON などの出力は、できるだけ **固定の期待値**で比較できる形に整える（順序、空白、時刻などの揺れを排除）。
- 仕様上の分岐（例: optional 要素、複数 attempts、部分点）を優先してテストする。
